---
title: "Создайте свою пару SSH ключей"
date: 2023-12-28
tags:
    - networking
    - ssh
preview: 'Если у вы используете пароль для подключения по SSH, создайте вместо этого свой SSH-ключ.'
img_credits: 'https://unsplash.com/photos/three-silver-keys-y5N2HDwagVw'
---

## Примечание

Данный гайд, создан для людей, которые уже настроили свой сервер, и рассказывает исключительно, про проброс ключей.

## Введение

**SSH (Secure Shell)** — широко используемый протокол для удаленного доступа к серверам. Он обеспечивает защищенное соединение между клиентом и сервером, используя шифрование данных. Однако, даже при такой защите, существует уязвимость — это использование паролей для аутентификации. К сожалению, до сих пор многие пользователи придерживаются уязвимых паролей типа "admin-admin" или используют слабые пароли, что создает риск для безопасности.

Одним из наиболее эффективных способов усиления безопасности SSH-соединения является использование SSH-ключей. SSH-ключи представляют собой пару криптографических ключей: приватного и публичного. Приватный ключ хранится на клиентской стороне, а публичный ключ — на сервере. Этот метод аутентификации обеспечивает значительно более высокий уровень безопасности по сравнению с использованием паролей.

## Создание своей пары ключей

Откройте терминал, и напишите следующую команду:

```
ssh-keygen
```

Вы также можете установить пароль для ключа, чтобы обеспечить дополнительную защиту в случае его компрометации.

Если вы ничего не меняли, вывод должен быть примерно такой:

```
Generating public/private rsa key pair.
Enter file in which to save the key (/home/solin/.ssh/id_rsa):
Enter passphrase (empty for no passphrase):
Enter same passphrase again:
Your identification has been saved in /home/solin/.ssh/id_rsa
Your public key has been saved in /home/solin/.ssh/id_rsa.pub
The key fingerprint is:
SHA256:L0U23WrmY+MZsVt4IwIVlfX7zo6Crbs2Z5/pvBix9g8 solin@SolinPC
The key's randomart image is:
+---[RSA 3072]----+
|          ...o.  |
|           o.. . |
|          = . . .|
|         + . .  .|
|        S . *  . |
|         + + *  .|
|        . oo& E .|
|         .+==# O |
|         .+B=+X+=|
+----[SHA256]-----+
```

Как мы видим, наш ключ сохранился по пути `.ssh/id_rsa` в вашей домашней папке, перейдите в вашу домашнюю папку.

Вы увидите там 2 файла `id_rsa` и `id_rsa.pub`, первый это ваш ключ (сохраните его в надежном месте), а второй это ваш публичный ключ, вы можете его использовать на любых серверах.

## Настройка VPS

Создайте директорию для ключей на сервере `.ssh`:

```
mkdir ~/.ssh
```

Задайте ей нужные права:

```
chmod 700 ~/.ssh
```

> 700 — в данном случае означает, что мы задаем права только для владельца файла [подробнее](https://ru.wikipedia.org/wiki/Chmod).

## Пуш публичного ключа на сервер

После создания публичного ключа, вам необходимо переместить ваш ключ на сервер, чтобы при обращении с вашего пк, на сервер, сервер сравнивал ключи, и его они совпадут, вас пустит на сервер.

### Пуш ключа из под Windows 11

```
scp $env:USERPROFILE/.ssh/id_rsa.pub пользователь@<айпи.вашего.прекрасного.сервера>:~/.ssh/auhorized_keys
```

### Пуш ключа из под Linux

```
ssh-copy-id пользователь@<айпи.вашего.прекрасного.сервера>
```

Вас спросит пароль в последний раз, и ключ будет успешно перемещен на ваш сервер.

## Отключение входа по паролю на сервере

После того как мы успешно переместили наш ключ, необходимо закрыть доступ по паролю, чтобы у нас был единственный способ подключения через наш ключ.

Переходим на нашем сервере в файл настройки ssh `/etc/ssh/sshd_config`

```
sudo nano /etc/ssh/sshd_config
```

**Если вы не используте пользователя root, для доступа к серверу, рекомендую заблокировать доступ к серверу через него**:

```
PermitRootLogin no
```

Отключение пароля в качестве метода аутентификации:

```
PasswordAuthentication no
```

Перезагрузим службу SSH:

```
sudo systemctl restart sshd
```

## Подключение без пароля

Теперь проверим, можем ли мы подключится без пароля к нашему VPS:

```
ssh пользователь@<айпи.вашего.прекрасного.сервера>
```

*Если имя вашего пользователя в системе и на сервере совпадает, вы можете написать только айпи-адрес.*

Если у вас все получилось, вы можете поделится этой статьей с друзьями/коллегами, и помочь им защитить их сервера.