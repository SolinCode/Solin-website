---
title: "Свой DNS сервер с DNS over HTTPS"
date: 2023-12-27
tags:
    - networking
    - dns
preview: 'Узнайте, как создать свой безопасный DNS с использованием протокола DoH для защиты личных данных и повышения безопасности.'
img_credits: 'https://unsplash.com/photos/black-and-silver-computer-ram-stick-EJe6LqEjHpA'
---

## Примечание

**DoH (DNS over HTTPS)** — это протокол, обеспечивающий безопасную передачу DNS-запросов через защищенное соединение HTTPS. Традиционно DNS-запросы осуществлялись в открытом виде, что делало их уязвимыми для перехвата и манипуляций. В DoH весь процесс DNS-запроса шифруется, обеспечивая повышенную конфиденциальность и защиту от подслушивания.

Если вы находитесь в стране в которой блокируют публичные DoH сервера, но вам необходим доступ к такому DNS, то вы можете создать свой DNS, плюсом будет блокировка рекламы, вредоносных сайтов, и т.д.

## Выбор VPS сервера

*Если вы находитесь в стране в которой не заблокирован доступ к общественным DoH серверам, вы можете использовать локальный сервер, либо Raspberry Pi, и вы получите надежный блокировщик рекламы с DoH.*

Для начала, вам необходимо купить VPS, в той стране где нет проблем с подключеним к DoH серверам.

Вы можете купить VPS, например у [DigitalOcean](https://www.digitalocean.com/), в Германии за $6.

Данный гайд сделан для настройки сервера на Ubuntu 22.04, так что при создании VPS, убедитесь что выбран именно эта операционная система.

## Настройка VPS

*В этом гайде, мы будем использовать AdGuard Home, это бесплатный сервис, для создания DNS и блокировщика рекламы.*

Подключитесь к вашему серверу по SSH (рекомендую обезопасить сервер, сделав подключение только по SSH-ключу, вместо пароля), и обновитесь до последней версии:
```
sudo apt update -y && sudo apt dist-upgrade
```

### Установка и настройка AdGuard

```
curl -s -S -L https://raw.githubusercontent.com/AdguardTeam/AdGuardHome/master/scripts/install.sh | sh -s -- -v
```

После успешной установки перейдите в бразуер, и введите:

```
<айпи-вашего-vps>:3000
```

И создайте аккаунт (не используйте слабый пароль, лучше запишите его в менеджер-паролей).

После завершения установки, перейдите в Settings -> DNS settings.

Вы увидите поле Upstream DNS server.

По умолчанию там будет:

```
https://dns10.quad9.net/dns-query
```

Вам нужно заменить этот адресс на:

```
https://dns.cloudflare.com/dns-query
```

### Подключение

Перейдите во вкладку Setup Guide, и вы увидете все методы подключения к вашему DNS.

Если вы не задавали другой порт вначале, то он у вас 53, по этому вы можете просто указывать айпи вашего сервера, это и будет ваш DNS.

Вы можете использовать его на устройству, прописав в настройках вашей операционной системы, так и на роутере (рекомендую), так вы получите защищенное соединение в вашей локальной сети, с блокировкой рекламы.




